
<html
<body>

<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="sleepless.js"></script>
<script src="mvc.js"></script>

<div id=form>
	<input type=text data-key="title" ><br>
	<textarea placeholder="Description"></textarea><br>
	<input type=number id="age" ><br>
	<select name=flavor>
		<option></option>
		<option>Foo</option>
		<option>Bar</option>
	</select><br>
	Are you happy? <input type=checkbox title="Are you happy?" ><br>

	Radio Station: 
		<input type=radio name="Station" station value=WKRP> WKRP
		&nbsp;&nbsp;&nbsp;
		<input type=radio name="Station" station value=KUOW> KUOW
		&nbsp;&nbsp;&nbsp;
		<input type=radio name="Station" station value=KCRAP> KCRAP

	<p>
	Organs:
		<input type=checkbox id="organs.kidney"> Kidney 
		&nbsp;
		<input type=checkbox name="organs.lung"> Lung 
		&nbsp;
		<input type=checkbox data-key="organs.heart"> Heart 

	<p>
	Pets:<br>
	Dogs:
		<input type=checkbox id="pets.dogs.spot"> Spot 
		&nbsp;
		<input type=checkbox name="pets.dogs.rover"> Rover 
		<br>
	Cats:
		<input type=checkbox name="pets.cats.mittens"> Mittens 
		&nbsp;
		<input type=checkbox name="pets.cats.stink"> Stink 
		<br>

	<p>
	Date: <input type=text data=isdate name="a_date">
	<hr>
</div>

<div>
	<input type=text value="this shouldn't change">
</div>

<script>

	MVC.set_data_keys($("#form").get(0));

	// coming out of model, and going into UI
	m2u_hook = function(e, v) {
		log("m2u_hook: v="+v+" data-key="+$(e).attr("data-key"));
		if($(e).attr("data") == "isdate") {
			return ts2us_mdy(v);
		}
		return v;
	}

	// coming out of UI, and going into model
	u2m_hook = function(e, v) {
		log("u2m_hook: v="+v+" data-key="+$(e).attr("data-key"));
		if($(e).attr("data") == "isdate") {
			return us2ts(v);
		}
		return v;
	}

	load = function() {
		data = JSON.parse(localStorage.getItem("data"));
		if(!data) 
			data = {};
		MVC.tie(data, m2u_hook, u2m_hook);
	}

	save = function() {
		var json = JSON.stringify(data);
		localStorage.setItem("data", json);
		log("saved: "+json);
	}

	var data = MVC.tie(null, m2u_hook, u2m_hook);

</script>

<input type=button value=Load onclick="load()">
<input type=button value=Save onclick="save()">

